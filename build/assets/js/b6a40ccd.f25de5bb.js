"use strict";(self.webpackChunkga4gh_starter_kit_docs=self.webpackChunkga4gh_starter_kit_docs||[]).push([[930],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},f=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=c(n),f=o,m=d["".concat(l,".").concat(f)]||d[f]||p[f]||a;return n?r.createElement(m,s(s({ref:t},u),{},{components:n})):r.createElement(m,s({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,s=new Array(a);s[0]=f;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[d]="string"==typeof e?e:o,s[1]=i;for(var c=2;c<a;c++)s[c]=n[c];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}f.displayName="MDXCreateElement"},5720:function(e,t,n){n.r(t),n.d(t,{assets:function(){return l},contentTitle:function(){return s},default:function(){return p},frontMatter:function(){return a},metadata:function(){return i},toc:function(){return c}});var r=n(3117),o=(n(7294),n(3905));const a={sidebar_position:3},s="Submitting workflow run requests to Starter Kit WES",i={unversionedId:"starter-kit-apis/wes/wes_run_request",id:"starter-kit-apis/wes/wes_run_request",title:"Submitting workflow run requests to Starter Kit WES",description:"The Starter Kit WES docker image comes prebundled with the ability to run jobs via Nextflow. In this section we will confirm that we can execute HTTP requests to a running Starter Kit WES service to trigger a Nextflow workflow run, and obtain the outputs of the run.",source:"@site/docs/starter-kit-apis/wes/wes_run_request.md",sourceDirName:"starter-kit-apis/wes",slug:"/starter-kit-apis/wes/wes_run_request",permalink:"/docs/starter-kit-apis/wes/wes_run_request",draft:!1,editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/starter-kit-apis/wes/wes_run_request.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Starter Kit WES Configuration",permalink:"/docs/starter-kit-apis/wes/wes_configuration"},next:{title:"Intro to Cookbooks",permalink:"/docs/cookbooks/intro"}},l={},c=[{value:"Server Setup",id:"server-setup",level:2},{value:"Test HTTP Requests",id:"test-http-requests",level:2},{value:"Service Info",id:"service-info",level:3},{value:"Submit Workflow Run Request",id:"submit-workflow-run-request",level:3},{value:"Monitor Workflow Status and Obtain Outputs",id:"monitor-workflow-status-and-obtain-outputs",level:3},{value:"stdout and stderr",id:"stdout-and-stderr",level:4}],u={toc:c},d="wrapper";function p(e){let{components:t,...n}=e;return(0,o.kt)(d,(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"submitting-workflow-run-requests-to-starter-kit-wes"},"Submitting workflow run requests to Starter Kit WES"),(0,o.kt)("p",null,"The Starter Kit WES docker image comes prebundled with the ability to run jobs via Nextflow. In this section we will confirm that we can execute HTTP requests to a running Starter Kit WES service to trigger a Nextflow workflow run, and obtain the outputs of the run."),(0,o.kt)("h2",{id:"server-setup"},"Server Setup"),(0,o.kt)("p",null,"First, let's create the YAML config file that the Starter Kit WES service will load properties from. In a new working directory, create a subdirectory ",(0,o.kt)("inlineCode",{parentName:"p"},"config")," with a single file ",(0,o.kt)("inlineCode",{parentName:"p"},"config.yml"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"mkdir config\ntouch config/config.yml\n")),(0,o.kt)("p",null,"Using any text editor, write the following YAML to ",(0,o.kt)("inlineCode",{parentName:"p"},"config/config.yml"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"wes:\n  serverProps:\n    publicApiPort: 7500\n    adminApiPort: 7501\n  serviceInfo:\n    id: org.ga4gh.demo.wes.test\n    name: WES API Test Demo\n  databaseProps:\n    url: jdbc:sqlite:/home/user/db/ga4gh-starter-kit.dev.db\n")),(0,o.kt)("p",null,"We also need to create a working directory mount between the host and container. To start, we first create this directory on the host, e.g."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"mkdir -p /tmp/shared/wes\n")),(0,o.kt)("p",null,"We are ready to start the WES service. Run the following command to spin up a WES + Nextflow docker container (substituting any parameters as relevant to your filesystem/environment):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'docker run \\\n  -d \\\n  --name sk-wes-test \\\n  --rm \\\n  -v `pwd`/config:/config \\\n  -v /var/run/docker.sock:/var/run/docker.sock \\\n  -p 7500:7500 \\\n  -p 7501:7501 \\\n  -v /tmp/shared/wes:/tmp/shared/wes \\\n  --workdir "/tmp/shared/wes" \\\n  ga4gh/ga4gh-starter-kit-wes:0.2.0-nextflow \\\n  -c /config/config.yml\n')),(0,o.kt)("p",null,"In the above command, we create a docker container named ",(0,o.kt)("inlineCode",{parentName:"p"},"sk-wes-test")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"detached")," mode. We mount the YAML config file. We also mount the docker daemon socket and the working directory to allow the docker container to run docker processes on the host."),(0,o.kt)("h2",{id:"test-http-requests"},"Test HTTP Requests"),(0,o.kt)("h3",{id:"service-info"},"Service Info"),(0,o.kt)("p",null,"Let's begin by making a request to the ",(0,o.kt)("inlineCode",{parentName:"p"},"/service-info")," endpoint. Using your preferred API testing tool (e.g. Postman), issue the following HTTP request:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"GET http://localhost:7500/ga4gh/wes/v1/service-info\n")),(0,o.kt)("p",null,"You should receive a response with a status of ",(0,o.kt)("inlineCode",{parentName:"p"},"200"),", and a response body of:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n    "id": "org.ga4gh.demo.wes.test",\n    "name": "WES API Test Demo",\n    "description": "An open source, community-driven implementation of the GA4GH Workflow Execution Service (WES)API specification.",\n    "contactUrl": "mailto:info@ga4gh.org",\n    "documentationUrl": "https://github.com/ga4gh/ga4gh-starter-kit-wes",\n    "createdAt": "2020-01-15T12:00:00Z",\n    "updatedAt": "2020-01-15T12:00:00Z",\n    "environment": "test",\n    "version": "0.2.0",\n    "type": {\n        "group": "org.ga4gh",\n        "artifact": "wes",\n        "version": "1.0.1"\n    },\n    "organization": {\n        "name": "Global Alliance for Genomics and Health",\n        "url": "https://ga4gh.org"\n    },\n    "workflowTypeVersions": {\n        "NEXTFLOW": [\n            "21.04.0"\n        ]\n    },\n    "workflowEngineVersions": {\n        "NATIVE": ""\n    }\n}\n')),(0,o.kt)("h3",{id:"submit-workflow-run-request"},"Submit Workflow Run Request"),(0,o.kt)("p",null,"Next, let's trigger a workflow run by submitting a ",(0,o.kt)("inlineCode",{parentName:"p"},"POST")," request to the service's ",(0,o.kt)("inlineCode",{parentName:"p"},"/runs")," endpoint. Prepare the following HTTP request using your API testing tool:"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Method and URL")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"POST http://localhost:7500/ga4gh/wes/v1/runs\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Headers")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Content-Type: multipart/form-data\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Form Data (body)")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'workflow_type: NEXTFLOW\nworkflow_type_version: 21.04.0\nworkflow_url: https://github.com/jb-adams/md5-nf\nworkflow_params: {"file_int": 3}\n')),(0,o.kt)("p",null,"In the above request, we specify a workflow run according to the WES specification using the following parameter values:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"workflow_type"),": specifies that the workflow we want to run is written in Nexflow"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"workflow_type_version"),": specifies that we want to run Nextflow version 21.04.0"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"workflow_url"),": The workflow we want to run is hosted on Github. The workflow simply computes checksum digest values (",(0,o.kt)("inlineCode",{parentName:"li"},"md5"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"sha1"),", and ",(0,o.kt)("inlineCode",{parentName:"li"},"sha256"),") on 1 of 5 files prebundled with the workflow"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"workflow_params"),": We specify a ",(0,o.kt)("inlineCode",{parentName:"li"},"file_int")," of ",(0,o.kt)("inlineCode",{parentName:"li"},"3"),", that is, we want to compute checksum values on the 3rd prebundled file")),(0,o.kt)("p",null,"You should receive a response with a status of ",(0,o.kt)("inlineCode",{parentName:"p"},"200"),", and a response body resembling the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n    "run_id": "e4d25c91-f950-4c4b-8616-cfafe83296c8"\n}\n')),(0,o.kt)("p",null,"This indicates the server successfully accepted the job request. The exact value of ",(0,o.kt)("inlineCode",{parentName:"p"},"run_id")," will be different than the above, as the server randomly assigns a unique ID to each request."),(0,o.kt)("h3",{id:"monitor-workflow-status-and-obtain-outputs"},"Monitor Workflow Status and Obtain Outputs"),(0,o.kt)("p",null,"Using the ",(0,o.kt)("inlineCode",{parentName:"p"},"run_id")," we obtained from the service, we can obtain information about the run. Issue the following request (using the ",(0,o.kt)("inlineCode",{parentName:"p"},"run_id")," you obtained):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"GET http://localhost:7500/ga4gh/wes/v1/runs/e4d25c91-f950-4c4b-8616-cfafe83296c8\n")),(0,o.kt)("p",null,"You should receive a response with a status of ",(0,o.kt)("inlineCode",{parentName:"p"},"200"),", and a response body resembling:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n    "run_id": "e4d25c91-f950-4c4b-8616-cfafe83296c8",\n    "request": {\n        "workflow_params": {\n            "file_int": 3\n        },\n        "workflow_type": "NEXTFLOW",\n        "workflow_type_version": "21.04.0",\n        "workflow_url": "https://github.com/jb-adams/md5-nf"\n    },\n    "state": "COMPLETE",\n    "run_log": {\n        "name": "jb-adams/md5-nf",\n        "cmd": [\n            "#!/bin/bash -ue",\n            "echo \\"Running md5 on /data/3.json\\" >&2",\n            "md5sum /data/3.json | cut -f 1 -d \' \'",\n            "#!/bin/bash -ue",\n            "echo \\"Running sha1 on /data/3.json\\" >&2",\n            "sha1sum /data/3.json | cut -f 1 -d \' \'",\n            "#!/bin/bash -ue",\n            "echo \\"Running sha256 on /data/3.json\\" >&2",\n            "sha256sum /data/3.json | cut -f 1 -d \' \'"\n        ],\n        "start_time": "2021-08-26T18:46:19Z",\n        "end_time": "2021-08-26T18:46:21Z",\n        "stdout": "http://localhost:7500/ga4gh/wes/v1/logs/nextflow/stdout/e4d25c91-f950-4c4b-8616-cfafe83296c8?workdirs=96%2F9094b1f92135bc9b9e72b9ec1629cf%2Cb0%2Ff8fc3696479989ba6cc3c1914f6f6d%2Cc3%2F9c00d208bf6d0bd994693a0a6956ea",\n        "stderr": "http://localhost:7500/ga4gh/wes/v1/logs/nextflow/stderr/e4d25c91-f950-4c4b-8616-cfafe83296c8?workdirs=96%2F9094b1f92135bc9b9e72b9ec1629cf%2Cb0%2Ff8fc3696479989ba6cc3c1914f6f6d%2Cc3%2F9c00d208bf6d0bd994693a0a6956ea",\n        "exit_code": 0\n    },\n    "task_logs": [\n        {\n            "name": "md5",\n            "cmd": [\n                "#!/bin/bash -ue",\n                "echo \\"Running md5 on /data/3.json\\" >&2",\n                "md5sum /data/3.json | cut -f 1 -d \' \'"\n            ],\n            "start_time": "2021-08-26T18:46:19Z",\n            "end_time": "2021-08-26T18:46:20Z",\n            "stdout": "http://localhost:7500/ga4gh/wes/v1/logs/nextflow/stdout/e4d25c91-f950-4c4b-8616-cfafe83296c8/96/9094b1f92135bc9b9e72b9ec1629cf",\n            "stderr": "http://localhost:7500/ga4gh/wes/v1/logs/nextflow/stderr/e4d25c91-f950-4c4b-8616-cfafe83296c8/96/9094b1f92135bc9b9e72b9ec1629cf",\n            "exit_code": 0\n        },\n        {\n            "name": "sha1",\n            "cmd": [\n                "#!/bin/bash -ue",\n                "echo \\"Running sha1 on /data/3.json\\" >&2",\n                "sha1sum /data/3.json | cut -f 1 -d \' \'"\n            ],\n            "start_time": "2021-08-26T18:46:20Z",\n            "end_time": "2021-08-26T18:46:20Z",\n            "stdout": "http://localhost:7500/ga4gh/wes/v1/logs/nextflow/stdout/e4d25c91-f950-4c4b-8616-cfafe83296c8/b0/f8fc3696479989ba6cc3c1914f6f6d",\n            "stderr": "http://localhost:7500/ga4gh/wes/v1/logs/nextflow/stderr/e4d25c91-f950-4c4b-8616-cfafe83296c8/b0/f8fc3696479989ba6cc3c1914f6f6d",\n            "exit_code": 0\n        },\n        {\n            "name": "sha256",\n            "cmd": [\n                "#!/bin/bash -ue",\n                "echo \\"Running sha256 on /data/3.json\\" >&2",\n                "sha256sum /data/3.json | cut -f 1 -d \' \'"\n            ],\n            "start_time": "2021-08-26T18:46:21Z",\n            "end_time": "2021-08-26T18:46:21Z",\n            "stdout": "http://localhost:7500/ga4gh/wes/v1/logs/nextflow/stdout/e4d25c91-f950-4c4b-8616-cfafe83296c8/c3/9c00d208bf6d0bd994693a0a6956ea",\n            "stderr": "http://localhost:7500/ga4gh/wes/v1/logs/nextflow/stderr/e4d25c91-f950-4c4b-8616-cfafe83296c8/c3/9c00d208bf6d0bd994693a0a6956ea",\n            "exit_code": 0\n        }\n    ],\n    "outputs": {}\n}\n')),(0,o.kt)("p",null,"From the request, we see the ",(0,o.kt)("inlineCode",{parentName:"p"},"run_id")," and the original parameters we supplied to trigger the workflow run in the ",(0,o.kt)("inlineCode",{parentName:"p"},"request")," attribute. The ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," attribute tells us that the job completed successfully."),(0,o.kt)("h4",{id:"stdout-and-stderr"},"stdout and stderr"),(0,o.kt)("p",null,"If we follow the URLs provided in the ",(0,o.kt)("inlineCode",{parentName:"p"},"run_log.stdout")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"run_log.stderr")," attributes, we can see the standard output and standard error produced during the workflow run."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"stdout request")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"GET http://localhost:7500/ga4gh/wes/v1/logs/nextflow/stdout/e4d25c91-f950-4c4b-8616-cfafe83296c8?workdirs=96%2F9094b1f92135bc9b9e72b9ec1629cf%2Cb0%2Ff8fc3696479989ba6cc3c1914f6f6d%2Cc3%2F9c00d208bf6d0bd994693a0a6956ea\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"stdout response")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"284bc700ae1456223c514fa64bee948c\n\n0a8d6f1af30ead10b0b113c6785bc415100fd130\n\ne43d20405adee85ac532db75a3e4c32bd96a775dd7bbf43d7df4437cd4b68dcf\n")),(0,o.kt)("p",null,"The md5, sha1, and sha256 digest values were written to stdout during the run."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"stderr request")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"GET http://localhost:7500/ga4gh/wes/v1/logs/nextflow/stderr/e4d25c91-f950-4c4b-8616-cfafe83296c8?workdirs=96%2F9094b1f92135bc9b9e72b9ec1629cf%2Cb0%2Ff8fc3696479989ba6cc3c1914f6f6d%2Cc3%2F9c00d208bf6d0bd994693a0a6956ea\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"stderr response")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Running md5 on /data/3.json\n\nRunning sha1 on /data/3.json\n\nRunning sha256 on /data/3.json\n")),(0,o.kt)("p",null,"The above messages were written to stderr during the run."))}p.isMDXComponent=!0}}]);